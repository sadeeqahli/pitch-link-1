{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"abort-controller/polyfill","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":35,"index":35}}],"key":"Zt445sKJeaqmd3t2yOR0GF+G/L0=","exportNames":["*"],"imports":1}},{"name":"expo-modules-core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":36},"end":{"line":2,"column":56,"index":92}}],"key":"fU8WLIPqoAGygnPbZ/QJiQQfXEY=","exportNames":["*"],"imports":1}},{"name":"./ServerRegistrationModule","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":93},"end":{"line":3,"column":66,"index":159}}],"key":"OTliNP9lxRDJOLdh5XsGIjq12GA=","exportNames":["*"],"imports":1}},{"name":"./TokenEmitter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":160},"end":{"line":4,"column":54,"index":214}}],"key":"5j/AymtYsxXL7qVrWh9rwW/7ePw=","exportNames":["*"],"imports":1}},{"name":"./getDevicePushTokenAsync","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":215},"end":{"line":5,"column":64,"index":279}}],"key":"XdMNnezmMyUe2eZLOsw/aE7Mhfk=","exportNames":["*"],"imports":1}},{"name":"./utils/updateDevicePushTokenAsync","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":280},"end":{"line":6,"column":120,"index":400}}],"key":"153jXZ66s6HybIv8YrABEWMrDwY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.setAutoServerRegistrationEnabledAsync = setAutoServerRegistrationEnabledAsync;\n  exports.__handlePersistedRegistrationInfoAsync = __handlePersistedRegistrationInfoAsync;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  require(_dependencyMap[1], \"abort-controller/polyfill\");\n  var _expoModulesCore = require(_dependencyMap[2], \"expo-modules-core\");\n  var _ServerRegistrationModule = require(_dependencyMap[3], \"./ServerRegistrationModule\");\n  var ServerRegistrationModule = _interopDefault(_ServerRegistrationModule);\n  var _TokenEmitter = require(_dependencyMap[4], \"./TokenEmitter\");\n  var _getDevicePushTokenAsync = require(_dependencyMap[5], \"./getDevicePushTokenAsync\");\n  var getDevicePushTokenAsync = _interopDefault(_getDevicePushTokenAsync);\n  var _utilsUpdateDevicePushTokenAsync = require(_dependencyMap[6], \"./utils/updateDevicePushTokenAsync\");\n  var lastAbortController = null;\n  function updatePushTokenAsync(_x) {\n    return _updatePushTokenAsync.apply(this, arguments);\n  }\n  /**\n   * @hidden - the comment is misleading and the purpose of the function needs to be reevaluated\n   *\n   * Sets the registration information so that the device push token gets pushed\n   * to the given registration endpoint\n   * @param enabled\n   */\n  function _updatePushTokenAsync() {\n    _updatePushTokenAsync = (0, _asyncToGenerator.default)(function* (token) {\n      // Abort current update process\n      lastAbortController?.abort();\n      lastAbortController = new AbortController();\n      return yield (0, _utilsUpdateDevicePushTokenAsync.updateDevicePushTokenAsync)(lastAbortController.signal, token);\n    });\n    return _updatePushTokenAsync.apply(this, arguments);\n  }\n  function setAutoServerRegistrationEnabledAsync(_x2) {\n    return _setAutoServerRegistrationEnabledAsync.apply(this, arguments);\n  } // note(Chmiela): This function is exported only for testing purposes.\n  function _setAutoServerRegistrationEnabledAsync() {\n    _setAutoServerRegistrationEnabledAsync = (0, _asyncToGenerator.default)(function* (enabled) {\n      // We are overwriting registration, so we shouldn't let\n      // any pending request complete.\n      lastAbortController?.abort();\n      if (!ServerRegistrationModule.default.setRegistrationInfoAsync) {\n        throw new _expoModulesCore.UnavailabilityError('ServerRegistrationModule', 'setRegistrationInfoAsync');\n      }\n      yield ServerRegistrationModule.default.setRegistrationInfoAsync(enabled ? JSON.stringify({\n        isEnabled: enabled\n      }) : null);\n    });\n    return _setAutoServerRegistrationEnabledAsync.apply(this, arguments);\n  }\n  function __handlePersistedRegistrationInfoAsync(_x3) {\n    return _handlePersistedRegistrationInfoAsync.apply(this, arguments);\n  }\n  function _handlePersistedRegistrationInfoAsync() {\n    _handlePersistedRegistrationInfoAsync = (0, _asyncToGenerator.default)(function* (registrationInfo) {\n      if (!registrationInfo) {\n        // No registration info, nothing to do\n        return;\n      }\n      var registration = null;\n      try {\n        registration = JSON.parse(registrationInfo);\n      } catch (e) {\n        console.warn('[expo-notifications] Error encountered while fetching registration information for auto token updates.', e);\n      }\n      if (!registration?.isEnabled) {\n        // Registration is invalid or not enabled, nothing more to do\n        return;\n      }\n      try {\n        // Since the registration is enabled, fetching a \"new\" device token\n        // shouldn't be a problem.\n        var latestDevicePushToken = yield (0, getDevicePushTokenAsync.default)();\n        yield updatePushTokenAsync(latestDevicePushToken);\n      } catch (e) {\n        console.warn('[expo-notifications] Error encountered while updating server registration with latest device push token.', e);\n      }\n    });\n    return _handlePersistedRegistrationInfoAsync.apply(this, arguments);\n  }\n  if (ServerRegistrationModule.default.getRegistrationInfoAsync) {\n    // A global scope (to get all the updates) device push token\n    // subscription, never cleared.\n    (0, _TokenEmitter.addPushTokenListener)(/*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator.default)(function* (token) {\n        try {\n          // Before updating the push token on server we always check if we should\n          // Since modules can't change their method availability while running, we\n          // can assert it's defined.\n          var registrationInfo = yield ServerRegistrationModule.default.getRegistrationInfoAsync();\n          if (!registrationInfo) {\n            // Registration is not enabled\n            return;\n          }\n          var registration = JSON.parse(registrationInfo);\n          if (registration?.isEnabled) {\n            // Dispatch an abortable task to update\n            // registration with new token.\n            yield updatePushTokenAsync(token);\n          }\n        } catch (e) {\n          console.warn('[expo-notifications] Error encountered while updating server registration with latest device push token.', e);\n        }\n      });\n      return function (_x4) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    // Verify if persisted registration\n    // has successfully uploaded last known\n    // device push token. If not, retry.\n    ServerRegistrationModule.default.getRegistrationInfoAsync().then(__handlePersistedRegistrationInfoAsync);\n  } else {\n    console.warn(`[expo-notifications] Error encountered while fetching auto-registration state, new tokens will not be automatically registered on server.`, new _expoModulesCore.UnavailabilityError('ServerRegistrationModule', 'getRegistrationInfoAsync'));\n  }\n});","lineCount":126,"map":[[12,2,21,0,"exports"],[12,9,21,0],[12,10,21,0,"setAutoServerRegistrationEnabledAsync"],[12,47,21,0],[12,50,21,0,"setAutoServerRegistrationEnabledAsync"],[12,87,21,0],[13,2,31,0,"exports"],[13,9,31,0],[13,10,31,0,"__handlePersistedRegistrationInfoAsync"],[13,48,31,0],[13,51,31,0,"__handlePersistedRegistrationInfoAsync"],[13,89,31,0],[14,2,56,1],[14,6,56,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,42,56,1],[14,45,56,1,"require"],[14,52,56,1],[14,53,56,1,"_dependencyMap"],[14,67,56,1],[15,2,56,1],[15,6,56,1,"_asyncToGenerator"],[15,23,56,1],[15,26,56,1,"_interopDefault"],[15,41,56,1],[15,42,56,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,78,56,1],[16,2,1,0,"require"],[16,9,1,0],[16,10,1,0,"_dependencyMap"],[16,24,1,0],[17,2,2,0],[17,6,2,0,"_expoModulesCore"],[17,22,2,0],[17,25,2,0,"require"],[17,32,2,0],[17,33,2,0,"_dependencyMap"],[17,47,2,0],[18,2,3,0],[18,6,3,0,"_ServerRegistrationModule"],[18,31,3,0],[18,34,3,0,"require"],[18,41,3,0],[18,42,3,0,"_dependencyMap"],[18,56,3,0],[19,2,3,0],[19,6,3,0,"ServerRegistrationModule"],[19,30,3,0],[19,33,3,0,"_interopDefault"],[19,48,3,0],[19,49,3,0,"_ServerRegistrationModule"],[19,74,3,0],[20,2,4,0],[20,6,4,0,"_TokenEmitter"],[20,19,4,0],[20,22,4,0,"require"],[20,29,4,0],[20,30,4,0,"_dependencyMap"],[20,44,4,0],[21,2,5,0],[21,6,5,0,"_getDevicePushTokenAsync"],[21,30,5,0],[21,33,5,0,"require"],[21,40,5,0],[21,41,5,0,"_dependencyMap"],[21,55,5,0],[22,2,5,0],[22,6,5,0,"getDevicePushTokenAsync"],[22,29,5,0],[22,32,5,0,"_interopDefault"],[22,47,5,0],[22,48,5,0,"_getDevicePushTokenAsync"],[22,72,5,0],[23,2,6,0],[23,6,6,0,"_utilsUpdateDevicePushTokenAsync"],[23,38,6,0],[23,41,6,0,"require"],[23,48,6,0],[23,49,6,0,"_dependencyMap"],[23,63,6,0],[24,2,7,0],[24,6,7,4,"lastAbortController"],[24,25,7,23],[24,28,7,26],[24,32,7,30],[25,2,7,31],[25,11,8,15,"updatePushTokenAsync"],[25,31,8,35,"updatePushTokenAsync"],[25,32,8,35,"_x"],[25,34,8,35],[26,4,8,35],[26,11,8,35,"_updatePushTokenAsync"],[26,32,8,35],[26,33,8,35,"apply"],[26,38,8,35],[26,45,8,35,"arguments"],[26,54,8,35],[27,2,8,35],[28,2,14,0],[29,0,15,0],[30,0,16,0],[31,0,17,0],[32,0,18,0],[33,0,19,0],[34,0,20,0],[35,2,14,0],[35,11,14,0,"_updatePushTokenAsync"],[35,33,14,0],[36,4,14,0,"_updatePushTokenAsync"],[36,25,14,0],[36,32,14,0,"_asyncToGenerator"],[36,49,14,0],[36,50,14,0,"default"],[36,57,14,0],[36,59,8,0],[36,70,8,36,"token"],[36,75,8,41],[36,77,8,43],[37,6,9,4],[38,6,10,4,"lastAbortController"],[38,25,10,23],[38,27,10,25,"abort"],[38,32,10,30],[38,33,10,31],[38,34,10,32],[39,6,11,4,"lastAbortController"],[39,25,11,23],[39,28,11,26],[39,32,11,30,"AbortController"],[39,47,11,45],[39,48,11,46],[39,49,11,47],[40,6,12,4],[40,19,12,17],[40,23,12,17,"updateDevicePushTokenAsyncWithSignal"],[40,55,12,53],[40,56,12,53,"updateDevicePushTokenAsync"],[40,82,12,53],[40,84,12,54,"lastAbortController"],[40,103,12,73],[40,104,12,74,"signal"],[40,110,12,80],[40,112,12,82,"token"],[40,117,12,87],[40,118,12,88],[41,4,13,0],[41,5,13,1],[42,4,13,1],[42,11,13,1,"_updatePushTokenAsync"],[42,32,13,1],[42,33,13,1,"apply"],[42,38,13,1],[42,45,13,1,"arguments"],[42,54,13,1],[43,2,13,1],[44,2,13,1],[44,11,21,22,"setAutoServerRegistrationEnabledAsync"],[44,48,21,59,"setAutoServerRegistrationEnabledAsync"],[44,49,21,59,"_x2"],[44,52,21,59],[45,4,21,59],[45,11,21,59,"_setAutoServerRegistrationEnabledAsync"],[45,49,21,59],[45,50,21,59,"apply"],[45,55,21,59],[45,62,21,59,"arguments"],[45,71,21,59],[46,2,21,59],[46,4,30,0],[47,2,30,0],[47,11,30,0,"_setAutoServerRegistrationEnabledAsync"],[47,50,30,0],[48,4,30,0,"_setAutoServerRegistrationEnabledAsync"],[48,42,30,0],[48,49,30,0,"_asyncToGenerator"],[48,66,30,0],[48,67,30,0,"default"],[48,74,30,0],[48,76,21,7],[48,87,21,60,"enabled"],[48,94,21,67],[48,96,21,69],[49,6,22,4],[50,6,23,4],[51,6,24,4,"lastAbortController"],[51,25,24,23],[51,27,24,25,"abort"],[51,32,24,30],[51,33,24,31],[51,34,24,32],[52,6,25,4],[52,10,25,8],[52,11,25,9,"ServerRegistrationModule"],[52,35,25,33],[52,36,25,33,"default"],[52,43,25,33],[52,44,25,34,"setRegistrationInfoAsync"],[52,68,25,58],[52,70,25,60],[53,8,26,8],[53,14,26,14],[53,18,26,18,"UnavailabilityError"],[53,34,26,37],[53,35,26,37,"UnavailabilityError"],[53,54,26,37],[53,55,26,38],[53,81,26,64],[53,83,26,66],[53,109,26,92],[53,110,26,93],[54,6,27,4],[55,6,28,4],[55,12,28,10,"ServerRegistrationModule"],[55,36,28,34],[55,37,28,34,"default"],[55,44,28,34],[55,45,28,35,"setRegistrationInfoAsync"],[55,69,28,59],[55,70,28,60,"enabled"],[55,77,28,67],[55,80,28,70,"JSON"],[55,84,28,74],[55,85,28,75,"stringify"],[55,94,28,84],[55,95,28,85],[56,8,28,87,"isEnabled"],[56,17,28,96],[56,19,28,98,"enabled"],[57,6,28,106],[57,7,28,107],[57,8,28,108],[57,11,28,111],[57,15,28,115],[57,16,28,116],[58,4,29,0],[58,5,29,1],[59,4,29,1],[59,11,29,1,"_setAutoServerRegistrationEnabledAsync"],[59,49,29,1],[59,50,29,1,"apply"],[59,55,29,1],[59,62,29,1,"arguments"],[59,71,29,1],[60,2,29,1],[61,2,29,1],[61,11,31,22,"__handlePersistedRegistrationInfoAsync"],[61,49,31,60,"__handlePersistedRegistrationInfoAsync"],[61,50,31,60,"_x3"],[61,53,31,60],[62,4,31,60],[62,11,31,60,"_handlePersistedRegistrationInfoAsync"],[62,48,31,60],[62,49,31,60,"apply"],[62,54,31,60],[62,61,31,60,"arguments"],[62,70,31,60],[63,2,31,60],[64,2,31,60],[64,11,31,60,"_handlePersistedRegistrationInfoAsync"],[64,49,31,60],[65,4,31,60,"_handlePersistedRegistrationInfoAsync"],[65,41,31,60],[65,48,31,60,"_asyncToGenerator"],[65,65,31,60],[65,66,31,60,"default"],[65,73,31,60],[65,75,31,7],[65,86,31,61,"registrationInfo"],[65,102,31,77],[65,104,31,79],[66,6,32,4],[66,10,32,8],[66,11,32,9,"registrationInfo"],[66,27,32,25],[66,29,32,27],[67,8,33,8],[68,8,34,8],[69,6,35,4],[70,6,36,4],[70,10,36,8,"registration"],[70,22,36,20],[70,25,36,23],[70,29,36,27],[71,6,37,4],[71,10,37,8],[72,8,38,8,"registration"],[72,20,38,20],[72,23,38,23,"JSON"],[72,27,38,27],[72,28,38,28,"parse"],[72,33,38,33],[72,34,38,34,"registrationInfo"],[72,50,38,50],[72,51,38,51],[73,6,39,4],[73,7,39,5],[73,8,40,4],[73,15,40,11,"e"],[73,16,40,12],[73,18,40,14],[74,8,41,8,"console"],[74,15,41,15],[74,16,41,16,"warn"],[74,20,41,20],[74,21,41,21],[74,125,41,125],[74,127,41,127,"e"],[74,128,41,128],[74,129,41,129],[75,6,42,4],[76,6,43,4],[76,10,43,8],[76,11,43,9,"registration"],[76,23,43,21],[76,25,43,23,"isEnabled"],[76,34,43,32],[76,36,43,34],[77,8,44,8],[78,8,45,8],[79,6,46,4],[80,6,47,4],[80,10,47,8],[81,8,48,8],[82,8,49,8],[83,8,50,8],[83,12,50,14,"latestDevicePushToken"],[83,33,50,35],[83,42,50,44],[83,46,50,44,"getDevicePushTokenAsync"],[83,69,50,67],[83,70,50,67,"default"],[83,77,50,67],[83,79,50,68],[83,80,50,69],[84,8,51,8],[84,14,51,14,"updatePushTokenAsync"],[84,34,51,34],[84,35,51,35,"latestDevicePushToken"],[84,56,51,56],[84,57,51,57],[85,6,52,4],[85,7,52,5],[85,8,53,4],[85,15,53,11,"e"],[85,16,53,12],[85,18,53,14],[86,8,54,8,"console"],[86,15,54,15],[86,16,54,16,"warn"],[86,20,54,20],[86,21,54,21],[86,127,54,127],[86,129,54,129,"e"],[86,130,54,130],[86,131,54,131],[87,6,55,4],[88,4,56,0],[88,5,56,1],[89,4,56,1],[89,11,56,1,"_handlePersistedRegistrationInfoAsync"],[89,48,56,1],[89,49,56,1,"apply"],[89,54,56,1],[89,61,56,1,"arguments"],[89,70,56,1],[90,2,56,1],[91,2,57,0],[91,6,57,4,"ServerRegistrationModule"],[91,30,57,28],[91,31,57,28,"default"],[91,38,57,28],[91,39,57,29,"getRegistrationInfoAsync"],[91,63,57,53],[91,65,57,55],[92,4,58,4],[93,4,59,4],[94,4,60,4],[94,8,60,4,"addPushTokenListener"],[94,21,60,24],[94,22,60,24,"addPushTokenListener"],[94,42,60,24],[95,6,60,24],[95,10,60,24,"_ref"],[95,14,60,24],[95,21,60,24,"_asyncToGenerator"],[95,38,60,24],[95,39,60,24,"default"],[95,46,60,24],[95,48,60,25],[95,59,60,32,"token"],[95,64,60,37],[95,66,60,42],[96,8,61,8],[96,12,61,12],[97,10,62,12],[98,10,63,12],[99,10,64,12],[100,10,65,12],[100,14,65,18,"registrationInfo"],[100,30,65,34],[100,39,65,43,"ServerRegistrationModule"],[100,63,65,67],[100,64,65,67,"default"],[100,71,65,67],[100,72,65,68,"getRegistrationInfoAsync"],[100,96,65,92],[100,97,65,93],[100,98,65,94],[101,10,66,12],[101,14,66,16],[101,15,66,17,"registrationInfo"],[101,31,66,33],[101,33,66,35],[102,12,67,16],[103,12,68,16],[104,10,69,12],[105,10,70,12],[105,14,70,18,"registration"],[105,26,70,30],[105,29,70,33,"JSON"],[105,33,70,37],[105,34,70,38,"parse"],[105,39,70,43],[105,40,70,44,"registrationInfo"],[105,56,70,60],[105,57,70,61],[106,10,71,12],[106,14,71,16,"registration"],[106,26,71,28],[106,28,71,30,"isEnabled"],[106,37,71,39],[106,39,71,41],[107,12,72,16],[108,12,73,16],[109,12,74,16],[109,18,74,22,"updatePushTokenAsync"],[109,38,74,42],[109,39,74,43,"token"],[109,44,74,48],[109,45,74,49],[110,10,75,12],[111,8,76,8],[111,9,76,9],[111,10,77,8],[111,17,77,15,"e"],[111,18,77,16],[111,20,77,18],[112,10,78,12,"console"],[112,17,78,19],[112,18,78,20,"warn"],[112,22,78,24],[112,23,78,25],[112,129,78,131],[112,131,78,133,"e"],[112,132,78,134],[112,133,78,135],[113,8,79,8],[114,6,80,4],[114,7,80,5],[115,6,80,5],[115,23,80,5,"_x4"],[115,26,80,5],[116,8,80,5],[116,15,80,5,"_ref"],[116,19,80,5],[116,20,80,5,"apply"],[116,25,80,5],[116,32,80,5,"arguments"],[116,41,80,5],[117,6,80,5],[118,4,80,5],[118,8,80,6],[119,4,81,4],[120,4,82,4],[121,4,83,4],[122,4,84,4,"ServerRegistrationModule"],[122,28,84,28],[122,29,84,28,"default"],[122,36,84,28],[122,37,84,29,"getRegistrationInfoAsync"],[122,61,84,53],[122,62,84,54],[122,63,84,55],[122,64,84,56,"then"],[122,68,84,60],[122,69,84,61,"__handlePersistedRegistrationInfoAsync"],[122,107,84,99],[122,108,84,100],[123,2,85,0],[123,3,85,1],[123,9,86,5],[124,4,87,4,"console"],[124,11,87,11],[124,12,87,12,"warn"],[124,16,87,16],[124,17,87,17],[124,156,87,156],[124,158,87,158],[124,162,87,162,"UnavailabilityError"],[124,178,87,181],[124,179,87,181,"UnavailabilityError"],[124,198,87,181],[124,199,87,182],[124,225,87,208],[124,227,87,210],[124,253,87,236],[124,254,87,237],[124,255,87,238],[125,2,88,0],[126,0,88,1],[126,3]],"functionMap":{"names":["<global>","updatePushTokenAsync","setAutoServerRegistrationEnabledAsync","__handlePersistedRegistrationInfoAsync","addPushTokenListener$argument_0"],"mappings":"AAA;ACO;CDK;OEQ;CFQ;OGE;CHyB;yBII;KJoB"},"hasCjsExports":false},"type":"js/module"}]}